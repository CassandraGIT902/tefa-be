datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id       Int     @id @default(autoincrement())
  email    String  @unique
  name     String?
  password String
  role     Role    @default(USER) // Enum for user roles
  orders   Order[] // One-to-many relation with Order
  cart     Cart? // One-to-one relation with Cart
}

model Produk {
  id         Int         @id @default(autoincrement())
  title      String
  price      Float
  imgUrl     String
  type       ProdukType
  toko       Toko?       @relation(fields: [tokoId], references: [id])
  tokoId     Int?
  orderItems OrderItem[] // One-to-many relation with OrderItem
  inventory  Inventory? // One-to-one relation with Inventory
  cartItems  CartItem[] // One-to-many relation with CartItem (fix for missing opposite field)
}

enum ProdukType {
  Makanan
  Minuman
}

model Toko {
  id     Int      @id @default(autoincrement())
  tokoId Int
  name   String
  desc   String?
  produk Produk[] // One-to-many relation with Produk
}

model Order {
  id        Int         @id @default(autoincrement())
  user      User        @relation(fields: [userId], references: [id])
  userId    Int
  status    OrderStatus @default(Pending)
  total     Float
  items     OrderItem[] // One-to-many relation with OrderItem
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
}

enum OrderStatus {
  Pending
  Processing
  Shipped
  Delivered
  Cancelled
}

model OrderItem {
  id       Int    @id @default(autoincrement())
  order    Order  @relation(fields: [orderId], references: [id])
  orderId  Int
  produk   Produk @relation(fields: [produkId], references: [id])
  produkId Int
  quantity Int
  price    Float
}

model Cart {
  id     Int        @id @default(autoincrement())
  user   User       @relation(fields: [userId], references: [id])
  userId Int        @unique
  items  CartItem[] // One-to-many relation with CartItem
}

model CartItem {
  id       Int    @id @default(autoincrement())
  cart     Cart   @relation(fields: [cartId], references: [id])
  cartId   Int
  produk   Produk @relation(fields: [produkId], references: [id])
  produkId Int
  quantity Int
}

model Inventory {
  id       Int    @id @default(autoincrement())
  produk   Produk @relation(fields: [produkId], references: [id])
  produkId Int    @unique
  quantity Int
}

enum Role {
  USER
  ADMIN
}
